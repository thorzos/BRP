<div class="report-detail-container">
  <div *ngIf="!report" class="alert alert-info">
    Loading report details...
  </div>

  <div *ngIf="report">

    <!-- —— REPORT INFO —— -->
    <div class="detail-section">
      <label>Reporter</label>
      <div class="detail-value">{{ report.reporterUsername }}</div>
    </div>

    <div class="detail-section">
      <label>Target</label>
      <div class="detail-value">{{ report.targetUsername }}</div>
    </div>

    <div class="detail-section">
      <label>Type</label>
      <div class="detail-value">{{ report.type.replace('_', ' ') | titlecase }}</div>
    </div>

    <div class="detail-section">
      <label>Reason</label>
      <div class="detail-value">{{ report.reason }}</div>
    </div>

    <div class="detail-section">
      <label>Reported At</label>
      <div class="detail-value">{{ report.reportedAt | date:'medium' }}</div>
    </div>

    <hr/>

    <!-- —— JOB REQUEST INFO —— -->
    <ng-container *ngIf="report.type === 'JOB_REQUEST'">
      <div class="detail-section">
        <label>Title</label>
        <div class="detail-value title">{{ report.jobTitle }}</div>
      </div>

      <div class="details-grid">
        <div class="detail-section">
          <label>Deadline</label>
          <div class="detail-value">{{ report.deadline | date:'mediumDate' }}</div>
        </div>

        <div class="detail-section">
          <label>Category</label>
          <div class="detail-value">{{ formatDisplayString(report.category) }}</div>
        </div>

        <div class="detail-section">
          <label>Status</label>
          <div class="detail-value">{{ formatDisplayString(report.status) }}</div>
        </div>
      </div>

      <div class="detail-section">
        <label>Description</label>
        <div class="detail-value description">
          {{ report.description || 'No description provided.' }}
        </div>
      </div>
    </ng-container>

    <!-- —— MESSAGE SECTION —— -->
    <ng-container *ngIf="report.type === 'MESSAGE'">

      <div class="detail-section">
        <label>Content</label>
        <div class="detail-value" *ngIf="report.message; else deletedMessage">
          {{ report.message }}
        </div>
        <ng-template #deletedMessage>
          <span class="text-muted fst-italic">Message was already deleted</span>
        </ng-template>
      </div>


      <!-- —— MEDIA ATTACHMENT —— -->
      <ng-container *ngIf="report.mediaUrl">
        <div class="detail-section">
          <label>Attachment</label>
          <div class="detail-value">

            <!-- PDF case -->
            <ng-container *ngIf="report.mediaUrl.toLowerCase().endsWith('.pdf'); else imageBlock">
              <pdf-viewer
                [src]="environment.backendUrl + report.mediaUrl"
                [show-all]="false"
                [original-size]="false"
                [fit-to-page]="true"
                style="display:block; height:400px;"
              ></pdf-viewer>
              <a
                [href]="environment.backendUrl + report.mediaUrl"
                target="_blank"
                rel="noopener"
                class="d-block mt-2"
              >
                {{ report.mediaName }}
              </a>
            </ng-container>

            <!-- Image fallback -->
            <ng-template #imageBlock>
              <img
                [src]="environment.backendUrl + report.mediaUrl"
                [alt]="report.mediaName"
                class="img-fluid rounded mb-3"
                style="max-width: 400px; max-height: 400px; object-fit: contain;"
              />
            </ng-template>

          </div>
        </div>
      </ng-container>

      <div class="detail-section">
        <label>Sent At</label>
        <div class="detail-value">{{ report.timestamp | date:'medium' }}</div>
      </div>
    </ng-container>

    <!-- —— buttons —— -->
    <div class="action-buttons mt-3">
      <button class="btn btn--outline-secondary" (click)="onBack()">
        Back
      </button>
      <div class="btn-group">
        <button class="btn btn--secondary" *ngIf="report.type === 'JOB_REQUEST'" [routerLink]="['/admin/requests', report.jobId, 'details']">
          <i class="bi bi-eye"></i> View Job Request
        </button>
        <button *ngIf="report.isOpen" class="btn btn--danger" (click)="closeReport()">
          <i class="bi bi-x-circle"></i> Close Report
        </button>
        <button *ngIf="!report.isOpen" class="btn btn--success" (click)="openReport()">
          <i class="bi bi-check-circle"></i> Reopen Report
        </button>
      </div>
    </div>
  </div>
</div>

